From 332f7637751a807f1373f15bd8add8c6dfa5673c Mon Sep 17 00:00:00 2001
From: Marko Lindqvist <cazfi74@gmail.com>
Date: Sun, 1 May 2022 20:32:17 +0300
Subject: [PATCH 45/48] Meson: Disable delta-protocol from freeciv-web builds

See osdn #44456

Signed-off-by: Marko Lindqvist <cazfi74@gmail.com>
---
 gen_headers/meson_freeciv_config.h.in | 2 +-
 meson.build                           | 1 +
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/gen_headers/meson_freeciv_config.h.in b/gen_headers/meson_freeciv_config.h.in
index b81ca74e4c..c4cdc9e1f1 100644
--- a/gen_headers/meson_freeciv_config.h.in
+++ b/gen_headers/meson_freeciv_config.h.in
@@ -127,6 +127,6 @@
 #define FREECIV_JSON_PORT 6556
 
 /* Delta protocol enabled */
-#define FREECIV_DELTA_PROTOCOL
+#mesondefine FREECIV_DELTA_PROTOCOL
 
 #endif /* FC__FREECIV_CONFIG_H */
diff --git a/meson.build b/meson.build
index 063c278ec3..0e182151e2 100644
--- a/meson.build
+++ b/meson.build
@@ -74,6 +74,7 @@ if get_option('freeciv-web')
   pub_conf_data.set('FREECIV_WEB', 1)
   server_binary_name = 'freeciv-web'
 else
+  pub_conf_data.set('FREECIV_DELTA_PROTOCOL', 1)
   server_binary_name = 'freeciv-server'
 endif
 
-- 
2.35.1

